<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/logoko.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          [Node.js] 网页爬虫——实战（一） - Qso Blog| 苍山洱海
        
    </title>

    <link rel="canonical" href="https://qsoblog.gq/2017/06/20/post-6/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/contact/contact-bg-island.jpg')
            /*post*/
        
    }
    
    #signature{
        background-image: url('/img/signature/signature-white.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Node.js" title="Node.js">Node.js</a>
                            
                              <a class="tag" href="/tags/#cheerio" title="cheerio">cheerio</a>
                            
                        </div>
                        <h1>[Node.js] 网页爬虫——实战（一）</h1>
                        <h2 class="subheading">能用代码解决的事绝不动手</h2>
                        <span class="meta">
                            Posted by QSO.MR on
                            2017-06-20
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Qso Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="前言">前言</h1>
<hr>
<p>忙碌了几周以后偷得浮生半日闲，天真的我以为到了大三下学期课程应该会少一点吧，然而课多的想学一些新东西都没有足够的精力和时间。前端的知识已经放下好久没有动了，而且作为一个研狗意味着我需要放弃一些东西。但是不管怎样做自己喜欢的事情最重要。</p>
<h1 id="nodejs的介绍">Node.js的介绍</h1>
<hr>
<p>Node.js是什么?官方是这样解释的：</p>
<blockquote>
<p>Node.js® is a JavaScript runtime built on Chrome’s V8 JavaScript engine. Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient. Node.js’ package ecosystem, npm, is the largest ecosystem of open source libraries in the world.</p>
</blockquote>
<p>翻译过来就是：Node.js 是一个基于<code>Chrome V8</code> JavaScript引擎的JavaScript运行环境。Node.js使用事件驱动的非阻塞I / O模型，使其轻便且高效。 Node.js的包生态系统，<code>npm</code>，是世界上最大的开源图书馆生态系统。</p>
<p>根据我对Node.js的理解，它有如下几个特征：</p>
<ul>
<li>Nodejs是个可以运行在服务器端的一个js运行环境。</li>
<li>基于Chrome V8，对于js解析的速度非常快。</li>
<li>单进程，单线程，只支持单核CPU，不能充分的利用多核CPU服务器。</li>
<li>事件驱动与非阻塞的I/O，对高并发处理能力强。</li>
</ul>
<h2 id="nodejs的安装">#Node.js的安装</h2>
<p>Node.js的兼容性非常的强，Windows、Linux、Mac都可以安装。所以这也是它迅速在前端世界里迅速流行的一个重要因素。</p>
<h2 id="windows安装nodejs">##Windows安装Node.js</h2>
<p>进人<a href="https://nodejs.org/en/" target="_blank" rel="external">nodejs</a>官网,它已经自动为我们选择好对应系统的Node.js的两个版本：</p>
<p>Download for Windows (x64)</p>
<ul>
<li>V6.11.0 LTS Recommended For Most Users</li>
<li>V8.1.2 Current Latest Features</li>
</ul>
<p>我个人觉得使用V6.11.0 LTS的长期更新版本就可以了，但是如果你喜欢尝鲜也可以使用最新版本。这两个都是msi格式的文件，下载后可以傻瓜式地安装，并且会自动地将系统的环境变量PATH写好，以及装上相应版本的NPM（nodejs的插件包管理工具）。</p>
<h2 id="linux安装nodejs">##Linux安装Node.js</h2>
<p>因为我使用的是Ubuntu16.04（Yakkety）所以以下安装方法是基于Ubuntu系统而写。其他系统请自行百度</p>
<p>我们需要依次运行以下命令安装Node.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y python-software-properties</div><div class="line">curl <span class="_">-s</span>L https://deb.nodesource.com/setup_6.x | sudo -E bash –</div><div class="line">sudo apt-get install -y nodejs</div></pre></td></tr></table></figure>
<p>安装好后可以用<code>node -v</code>和<code>npm -v</code>检查一下是否安装成功</p>
<h2 id="nodejs爬虫小试牛刀">#Node.js爬虫小试牛刀</h2>
<p>一个简单的网页爬虫需要以下的几个步骤和模块：</p>
<ul>
<li>获取网页内容（http\request\superagent等）</li>
<li>筛选网页信息（cheerio）</li>
<li>输出或存储信息（console\fs\mongodb等）</li>
</ul>
<h2 id="http模块分析">##http模块分析</h2>
<p>我觉得要对http模块进行系统学习的最好办法就是阅读<a href="http://nodejs.cn/api/http.html" target="_blank" rel="external">官方文档</a>，有个大概的印象后以后学习就容易多了。</p>
<p>我们这次用的是http.get(options[, callback])类。根据官方文档的介绍：</p>
<ul>
<li>options <object> | <string> | <url> Accepts the same options as http.request(), with the method always set to GET. Properties that are inherited from the prototype are ignored.</url></string></object></li>
<li>callback <function></function></li>
<li>返回: &lt;http.ClientRequest&gt;</li>
</ul>
<blockquote>
<p>options 可以是一个对象、或字符串、或 URL 对象。 如果 options 是一个字符串，它会被自动使用 url.parse() 解析。 If it is a URL object, it will be automatically converted to an ordinary options object.<br>
可选的 callback 参数会作为单次监听器被添加到 ‘response’ 事件。<br>
http.request() 返回一个 http.ClientRequest 类的实例。 ClientRequest 实例是一个可写流。 如果需要通过 POST 请求上传一个文件，则写入到 ClientRequest 对象。</p>
</blockquote>
<p>一个例子：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="string">const</span> <span class="string">postData</span> <span class="string">=</span> <span class="string">querystring.stringify(&#123;</span></div><div class="line">  <span class="string">'msg'</span> <span class="string">:</span> <span class="string">'Hello World!'</span></div><div class="line"><span class="string">&#125;);</span></div><div class="line"></div><div class="line"><span class="string">const</span> <span class="string">options</span> <span class="string">=</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">  hostname:</span> <span class="string">'www.google.com'</span><span class="string">,</span></div><div class="line"><span class="attr">  port:</span> <span class="number">80</span><span class="string">,</span></div><div class="line"><span class="attr">  path:</span> <span class="string">'/upload'</span><span class="string">,</span></div><div class="line"><span class="attr">  method:</span> <span class="string">'POST'</span><span class="string">,</span></div><div class="line"><span class="attr">  headers:</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">    'Content-Type':</span> <span class="string">'application/x-www-form-urlencoded'</span><span class="string">,</span></div><div class="line"><span class="attr">    'Content-Length':</span> <span class="string">Buffer.byteLength(postData)</span></div><div class="line">  <span class="string">&#125;</span></div><div class="line"><span class="string">&#125;;</span></div><div class="line"></div><div class="line"><span class="string">const</span> <span class="string">req</span> <span class="string">=</span> <span class="string">http.request(options,</span> <span class="string">(res)</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></div><div class="line">  <span class="string">console.log(`状态码:</span> <span class="string">$&#123;res.statusCode&#125;`);</span></div><div class="line">  <span class="string">console.log(`响应头:</span> <span class="string">$&#123;JSON.stringify(res.headers)&#125;`);</span></div><div class="line">  <span class="string">res.setEncoding('utf8');</span></div><div class="line">  <span class="string">res.on('data',</span> <span class="string">(chunk)</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">console.log(`响应主体:</span> <span class="string">$&#123;chunk&#125;`);</span></div><div class="line">  <span class="string">&#125;);</span></div><div class="line">  <span class="string">res.on('end',</span> <span class="string">()</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">console.log('响应中已无数据。');</span></div><div class="line">  <span class="string">&#125;);</span></div><div class="line"><span class="string">&#125;);</span></div><div class="line"></div><div class="line"><span class="string">req.on('error',</span> <span class="string">(e)</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></div><div class="line">  <span class="string">console.error(`请求遇到问题:</span> <span class="string">$&#123;e.message&#125;`);</span></div><div class="line"><span class="string">&#125;);</span></div><div class="line"></div><div class="line"><span class="string">//</span> <span class="string">写入数据到请求主体</span></div><div class="line"><span class="string">req.write(postData);</span></div><div class="line"><span class="string">req.end();</span></div></pre></td></tr></table></figure>
<p>注意，在例子中调用了 req.end()。 使用 http.request() 必须总是调用 req.end() 来表明请求的结束，即使没有数据被写入请求主体。如果请求过程中遇到任何错误（DNS 解析错误、TCP 级的错误、或实际的 HTTP 解析错误），则在返回的请求对象中会触发 ‘error’ 事件。 对于所有的’error’ 事件，如果没有注册监听器，则抛出错误。</p>
<p>以下是需要注意的几个特殊的请求头。</p>
<ul>
<li>发送 ‘Connection: keep-alive’ 会通知 Node.js，服务器的连接应一直持续到下一个请求。</li>
<li>发送 ‘Content-Length’ 请求头会禁用默认的块编码。</li>
<li>发送 ‘Expect’ 请求头会立即发送请求头。 通常情况下，当发送 ‘Expect: 100-continue’ 时，超时时间与 continue 事件的监听器都需要被设置。</li>
<li>发送 Authorization 请求头会替代 auth 选项计算基本身份验证。</li>
</ul>
<h2 id="cheerio模块分析">##cheerio模块分析</h2>
<p>简单来说，cheerio就是服务器端的jQuery，去掉了jQuery的一些效果类和请求类等等功能后，仅保留核心对dom操作的部分，因此能够对dom进行和jQuery一样方便的操作。它是我们筛选数据的利器——把多余的html标签去掉，只留下我们想要的内容的重要工具。<br>
cheerio的类特别多，这里我只介绍几个常用的。</p>
<h2 id="attrname-value">###.attr(name[, value])</h2>
<blockquote>
<p>这个方法可以获取和设置属性，第二个参数是可选的。<br>
当第二个参数不存在时表示获取属性的值，当有带有第二个参数时，表示设置属性的值。<br>
如果设置一个属性的值设置为null ，则删除该属性。如下示例</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="string">var</span> <span class="string">html</span> <span class="string">=</span> <span class="string">'&lt;ul id="fruits"&gt;'</span> <span class="string">+</span></div><div class="line">    <span class="string">'   &lt;li class="apple"&gt;Apple&lt;/li&gt;'</span> <span class="string">+</span></div><div class="line">    <span class="string">'   &lt;li class="orange"&gt;Orange&lt;/li&gt;'</span> <span class="string">+</span></div><div class="line">    <span class="string">'   &lt;li class="pear"&gt;Pear&lt;/li&gt;'</span> <span class="string">+</span></div><div class="line">    <span class="string">'&lt;/ul&gt;'</span><span class="string">;</span></div><div class="line"><span class="string">var</span> <span class="string">cheerio</span> <span class="string">=</span> <span class="string">require('cheerio'),</span></div><div class="line"><span class="string">$</span> <span class="string">=</span> <span class="string">cheerio.load(html);</span></div><div class="line"></div><div class="line"><span class="string">$('ul').attr('id')</span></div><div class="line"><span class="string">&gt;=&gt;</span> <span class="string">fruits</span></div><div class="line"> </div><div class="line"><span class="string">$('.apple').attr('id',</span> <span class="string">'favorite'</span><span class="string">).html()</span></div><div class="line"><span class="string">&gt;=&gt;</span> <span class="string">&lt;li</span> <span class="string">class="apple"</span> <span class="string">id="favorite"&gt;Apple&lt;/li&gt;</span></div></pre></td></tr></table></figure>
<h2 id="mapfunctionindex-element">###.map(function(index, element){…})</h2>
<blockquote>
<p>和jquery类似的 each 迭代器，对每一个元素进行处理并返回一个值。</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="string">$('li').map(function(i,</span> <span class="string">el)</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">//</span> <span class="string">this</span> <span class="string">===</span> <span class="string">el</span></div><div class="line">    <span class="string">return</span> <span class="string">$(this).attr('class');</span></div><div class="line"><span class="string">&#125;).get().join(',</span> <span class="string">'); //=&gt; apple, orange, pear</span></div></pre></td></tr></table></figure>
<h2 id="findselector">###.find(selector)</h2>
<blockquote>
<p>在某元素下查询满足选择条件的元素。</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">$('#fruits').find('li').length;</span></div><div class="line"><span class="string">//=&gt;</span> <span class="number">3</span></div></pre></td></tr></table></figure>
<h2 id="npm模块">##npm模块</h2>
<p>实现效果：爬取盐城工学院官网学校<a href="http://www.ycit.cn/sjzjxjs/listhtml/schoolimportnews.shtml" target="_blank" rel="external">新闻版块</a>的文章标题和原文链接，并将其输出。</p>
<p>没有金刚钻，不揽瓷器活。我们需要引入以下几个模块</p>
<ul>
<li>http</li>
<li>cheerio</li>
</ul>
<p>在工作文件夹里输入’npm install cheerio sync-request --save’这样模块救引入好了。</p>
<h2 id="代码">##代码</h2>
<p>在程序开头引入模块：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">var</span> <span class="string">http</span> <span class="string">=</span> <span class="string">require('http');</span></div><div class="line"><span class="string">var</span> <span class="string">cheerio</span> <span class="string">=</span> <span class="string">require</span> <span class="string">('cheerio');</span></div><div class="line"><span class="string">var</span> <span class="string">url</span> <span class="string">=</span> <span class="string">'http://www.ycit.cn/sjzjxjs/listhtml/schoolimportnews.shtml'</span><span class="string">;</span></div></pre></td></tr></table></figure>
<p>接着就是获取网页内容</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="string">http.get(url,</span> <span class="string">function(res)</span> <span class="string">&#123;</span></div><div class="line">  <span class="string">var</span> <span class="string">html</span> <span class="string">=</span> <span class="string">''</span><span class="string">;</span></div><div class="line"></div><div class="line">  <span class="string">res.on('data',</span> <span class="string">function(data)</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">html</span> <span class="string">+=</span> <span class="string">data;</span></div><div class="line">  <span class="string">&#125;)</span></div><div class="line"></div><div class="line">  <span class="string">res.on('end',</span> <span class="string">function()</span> <span class="string">&#123;</span></div><div class="line">     <span class="string">console.log(html);</span></div><div class="line">  <span class="string">&#125;)</span></div><div class="line"><span class="string">&#125;).on('error',</span> <span class="string">function()&#123;</span></div><div class="line">  <span class="string">console.log('err');</span></div><div class="line"><span class="string">&#125;)</span></div></pre></td></tr></table></figure>
<p>然后就是用cheerio分析网页内容</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="string">function</span> <span class="string">crawlerChapter(html)</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">var</span> <span class="string">$</span> <span class="string">=</span> <span class="string">cheerio.load(html);</span></div><div class="line">    <span class="string">var</span> <span class="string">chapters</span> <span class="string">=</span> <span class="string">$('tr');</span></div><div class="line">    <span class="string">var</span> <span class="string">data</span> <span class="string">=</span> <span class="string">[];</span></div><div class="line"> </div><div class="line">    <span class="string">chapters.map(function</span> <span class="string">(node)</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">var</span> <span class="string">chapters</span> <span class="string">=</span> <span class="string">$(this);</span></div><div class="line">        <span class="string">var</span> <span class="string">chapterTitle</span> <span class="string">=</span> <span class="string">chapters.find('a').text().trim()+'\n';</span></div><div class="line">        <span class="string">var</span> <span class="string">sections</span> <span class="string">=</span> <span class="string">chapters.find('a');</span></div><div class="line">        <span class="string">var</span> <span class="string">chapterData</span> <span class="string">=</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">            chapterTitle:</span> <span class="string">chapterTitle,</span></div><div class="line"><span class="attr">            section:</span> <span class="string">[]</span></div><div class="line">        <span class="string">&#125;;</span></div><div class="line">        <span class="string">sections.map(function</span> <span class="string">(node)</span> <span class="string">&#123;</span></div><div class="line">            <span class="string">var</span> <span class="string">url</span> <span class="string">=</span> <span class="string">require('url')</span></div><div class="line">            <span class="string">var</span> <span class="string">section</span> <span class="string">=</span> <span class="string">url.resolve('http://www.ycit.cn',$(this).attr('href'));</span></div><div class="line">            <span class="string">chapterData.section.push(section);</span></div><div class="line">        <span class="string">&#125;);</span></div><div class="line">        <span class="string">data.push(chapterData);</span></div><div class="line">    <span class="string">&#125;);</span></div><div class="line">    <span class="string">return</span> <span class="string">data;</span></div><div class="line"><span class="string">&#125;;</span></div></pre></td></tr></table></figure>
<p>最后就是输出信息了。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="string">function</span> <span class="string">printInfo(data)</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">data</span> <span class="string">=</span> <span class="string">data.filter(function</span> <span class="string">filterByID(obj)</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">return</span> <span class="string">obj.chapterTitle</span> <span class="string">?</span> <span class="literal">true</span> <span class="string">:</span> <span class="literal">false</span><span class="string">;</span></div><div class="line">    <span class="string">&#125;);</span></div><div class="line">    <span class="string">data.map(function</span> <span class="string">(item)</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">var</span> <span class="string">chapterTitle</span> <span class="string">=</span> <span class="string">item.chapterTitle;</span></div><div class="line">        <span class="string">console.log(chapterTitle);</span></div><div class="line">        <span class="string">item.section.map(function</span> <span class="string">(section)</span> <span class="string">&#123;</span></div><div class="line">            <span class="string">console.log(section);</span></div><div class="line">        <span class="string">&#125;);</span></div><div class="line">    <span class="string">&#125;)</span></div><div class="line"><span class="string">&#125;;</span></div></pre></td></tr></table></figure>
<p>整个代码如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="string">var</span> <span class="string">http</span> <span class="string">=</span> <span class="string">require('http');</span></div><div class="line"><span class="string">var</span> <span class="string">cheerio</span> <span class="string">=</span> <span class="string">require</span> <span class="string">('cheerio');</span></div><div class="line"><span class="string">var</span> <span class="string">url</span> <span class="string">=</span> <span class="string">'http://www.ycit.cn/sjzjxjs/listhtml/schoolimportnews.shtml'</span><span class="string">;</span></div><div class="line"></div><div class="line"><span class="string">http.get(url,</span> <span class="string">function(res)</span> <span class="string">&#123;</span></div><div class="line">  <span class="string">var</span> <span class="string">html</span> <span class="string">=</span> <span class="string">''</span><span class="string">;</span></div><div class="line"></div><div class="line">  <span class="string">res.on('data',</span> <span class="string">function(data)</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">html</span> <span class="string">+=</span> <span class="string">data;</span></div><div class="line">  <span class="string">&#125;)</span></div><div class="line"></div><div class="line">  <span class="string">res.on('end',</span> <span class="string">function()</span> <span class="string">&#123;</span></div><div class="line">     <span class="string">var</span> <span class="string">chapter</span> <span class="string">=</span> <span class="string">crawlerChapter(html);</span></div><div class="line">     <span class="string">printInfo(chapter);</span></div><div class="line">  <span class="string">&#125;)</span></div><div class="line"><span class="string">&#125;).on('error',</span> <span class="string">function()&#123;</span></div><div class="line">  <span class="string">console.log('err');</span></div><div class="line"><span class="string">&#125;)</span></div><div class="line"></div><div class="line"><span class="string">function</span> <span class="string">crawlerChapter(html)</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">var</span> <span class="string">$</span> <span class="string">=</span> <span class="string">cheerio.load(html);</span></div><div class="line">    <span class="string">var</span> <span class="string">chapters</span> <span class="string">=</span> <span class="string">$('tr');</span></div><div class="line">    <span class="string">var</span> <span class="string">data</span> <span class="string">=</span> <span class="string">[];</span></div><div class="line"> </div><div class="line">    <span class="string">chapters.map(function</span> <span class="string">(node)</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">var</span> <span class="string">chapters</span> <span class="string">=</span> <span class="string">$(this);</span></div><div class="line">        <span class="string">var</span> <span class="string">chapterTitle</span> <span class="string">=</span> <span class="string">chapters.find('a').text().trim()+'\n';</span></div><div class="line">        <span class="string">var</span> <span class="string">sections</span> <span class="string">=</span> <span class="string">chapters.find('a');</span></div><div class="line">        <span class="string">var</span> <span class="string">chapterData</span> <span class="string">=</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">            chapterTitle:</span> <span class="string">chapterTitle,</span></div><div class="line"><span class="attr">            section:</span> <span class="string">[]</span></div><div class="line">        <span class="string">&#125;;</span></div><div class="line">        <span class="string">sections.map(function</span> <span class="string">(node)</span> <span class="string">&#123;</span></div><div class="line">            <span class="string">var</span> <span class="string">url</span> <span class="string">=</span> <span class="string">require('url')</span></div><div class="line">            <span class="string">var</span> <span class="string">section</span> <span class="string">=</span> <span class="string">url.resolve('http://www.ycit.cn',$(this).attr('href'));</span></div><div class="line">            <span class="string">chapterData.section.push(section);</span></div><div class="line">        <span class="string">&#125;);</span></div><div class="line">        <span class="string">data.push(chapterData);</span></div><div class="line">    <span class="string">&#125;);</span></div><div class="line">    <span class="string">return</span> <span class="string">data;</span></div><div class="line"><span class="string">&#125;;</span></div><div class="line"></div><div class="line"><span class="string">function</span> <span class="string">printInfo(data)</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">data</span> <span class="string">=</span> <span class="string">data.filter(function</span> <span class="string">filterByID(obj)</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">return</span> <span class="string">obj.chapterTitle</span> <span class="string">?</span> <span class="literal">true</span> <span class="string">:</span> <span class="literal">false</span><span class="string">;</span></div><div class="line">    <span class="string">&#125;);</span></div><div class="line">    <span class="string">data.map(function</span> <span class="string">(item)</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">var</span> <span class="string">chapterTitle</span> <span class="string">=</span> <span class="string">item.chapterTitle;</span></div><div class="line">        <span class="string">console.log(chapterTitle);</span></div><div class="line">        <span class="string">item.section.map(function</span> <span class="string">(section)</span> <span class="string">&#123;</span></div><div class="line">            <span class="string">console.log(section);</span></div><div class="line">        <span class="string">&#125;);</span></div><div class="line">    <span class="string">&#125;)</span></div><div class="line"><span class="string">&#125;;</span></div></pre></td></tr></table></figure>
<p>附上该爬虫的运行结果<br>
<img src="crawler.png" alt="crawler"><br>
这个爬虫已发布到我的<a href="https://github.com/QSOMR/crawler" target="_blank" rel="external">github</a>上。</p>
<h2 id="写在最后">#写在最后</h2>
<p>对于这个爬虫的扩展方向</p>
<ul>
<li>爬取单个文章页面的内容</li>
<li>将爬取的内容用bootstrap输出成html文件</li>
</ul>
<p>接下来就会向着这两个方向进行扩展完善。</p>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    
                        <li class="next">
                            <a href="/2017/05/30/post-5/" data-toggle="tooltip" data-placement="top" title="水一篇:记一次课程设计">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#前言"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">前言</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#nodejs的介绍"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">Node.js的介绍</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#nodejs的安装"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">#Node.js的安装</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#windows安装nodejs"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">##Windows安装Node.js</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#linux安装nodejs"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">##Linux安装Node.js</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#nodejs爬虫小试牛刀"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">#Node.js爬虫小试牛刀</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#http模块分析"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">##http模块分析</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#cheerio模块分析"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">##cheerio模块分析</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#attrname-value"><span class="toc-nav-number">2.7.</span> <span class="toc-nav-text">###.attr(name[, value])</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#mapfunctionindex-element"><span class="toc-nav-number">2.8.</span> <span class="toc-nav-text">###.map(function(index, element){…})</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#findselector"><span class="toc-nav-number">2.9.</span> <span class="toc-nav-text">###.find(selector)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#npm模块"><span class="toc-nav-number">2.10.</span> <span class="toc-nav-text">##npm模块</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代码"><span class="toc-nav-number">2.11.</span> <span class="toc-nav-text">##代码</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#写在最后"><span class="toc-nav-number">2.12.</span> <span class="toc-nav-text">#写在最后</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Node.js" title="Node.js">Node.js</a>
                        
                          <a class="tag" href="/tags/#cheerio" title="cheerio">cheerio</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://beantech.org" target="_blank">Bean Tech</a></li>
                    
                        <li><a href="http://blog.kaijun.rocks" target="_blank">Kaijun&#39;s Blog</a></li>
                    
                        <li><a href="http://huangxuan.me" target="_blank">Hux Blog</a></li>
                    
                        <li><a href="http://qsoblog.tunnel.qydev.com" target="_blank">苍山洱海</a></li>
                    
                        <li><a href="#" target="_blank">It Helps SEO</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "qsoblog";
    var disqus_identifier = "https://qsoblog.gq/2017/06/20/post-6/";
    var disqus_url = "https://qsoblog.gq/2017/06/20/post-6/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/qsoblog">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/QSOMR">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; QSO.MR 2017 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://qsoblog.gq/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-97181616-1';
    var _gaDomain = 'qsoblog.gq';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->






<!-- Image to hack wechat -->
<img src="https://qsoblog.gq/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
